<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GourmetERP - Ultra-Premium (Menu → Chef → Dashboard)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --primary:#2c3e50; --secondary:#c9902c; --light:#f5f7fa; --dark:#1e272e; --gray:#95a5a6;
}
[data-theme="dark"]{
  --light:#0f172a; --dark:#f5f7fa; --primary:#111827; --secondary:#fbbf24; --gray:#9ca3af;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:var(--light);color:var(--dark);transition:0.3s;display:flex;min-height:100vh;}

/* Sidebar */
.sidebar{width:220px;background:var(--primary);color:white;padding:20px 0;display:flex;flex-direction:column;min-height:100vh;position:sticky;top:0}
.logo{text-align:center;margin-bottom:20px;}
.logo h1{color:white;font-size:24px;letter-spacing:1px}
.menu-item{padding:12px 20px;display:flex;align-items:center;color:#ddd;text-decoration:none;font-weight:500;transition:all 0.2s;cursor:pointer}
.menu-item i{width:20px;margin-right:12px;font-size:16px;text-align:center;}
.menu-item:hover{background:rgba(255,255,255,0.1);color:white;border-left:4px solid var(--secondary);}
.menu-item.active{background:rgba(255,255,255,0.15);color:white;border-left:4px solid var(--secondary);}

/* Main container */
.main-container{flex:1;display:flex;flex-direction:column;padding:10px;gap:10px;}

/* Navbar */
.navbar{display:flex;justify-content:space-between;align-items:center;background:var(--primary);color:white;padding:10px 15px;border-radius:10px;flex-wrap:wrap;gap:10px}
.navbar .logo h1{color:var(--secondary);font-size:20px;margin:0;}
.navbar .search-bar{flex:1;display:flex;align-items:center;background:#fff;color: var(--dark);border-radius:25px;padding:5px 15px;max-width:340px}
[data-theme="dark"] .navbar .search-bar{background:#374151;color:white;}
.navbar .search-bar input{border:none;background:transparent;outline:none;width:100%;padding:5px;color:inherit}
.navbar .user-actions{display:flex;align-items:center;gap:10px}
.navbar .user-actions img{width:36px;height:36px;border-radius:50%;cursor:pointer}
.navbar button{background:none;border:none;color:white;font-size:18px;cursor:pointer}

/* Filters */
.filters{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap}
.filters button{padding:6px 12px;border:none;border-radius:6px;background:var(--primary);color:white;cursor:pointer;transition:0.2s}
.filters button.active{background:var(--secondary)}
.filters button:hover{opacity:0.9}

/* Content wrap */
.content-wrap{display:flex;flex-wrap:wrap;gap:20px}

/* Menu Grid */
.menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;flex:3;min-width:300px}
.menu-card{background:white;border-radius:15px;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,0.08);transition:transform 0.25s}
[data-theme="dark"] .menu-card{background:#1f2937;color:white}
.menu-card:hover{transform:translateY(-5px)}
.menu-card img{width:100%;height:160px;object-fit:cover}
.menu-card-content{padding:15px;display:flex;flex-direction:column;gap:6px}
.menu-card-content h3{margin:0;color:var(--primary)}
[data-theme="dark"] .menu-card-content h3{color:white}
.menu-card-content p{font-size:14px;color:var(--gray)}
[data-theme="dark"] .menu-card-content p{color:#cbd5e1}
.menu-card-content .price{font-weight:bold;color:var(--secondary)}
.menu-card-content button{padding:6px 10px;border:none;border-radius:8px;background:var(--secondary);color:white;cursor:pointer;transition:0.2s}
.menu-card-content button:hover{background:var(--primary)}

/* Cart */
.cart{background:#f0f0f0;border-radius:10px;padding:15px;max-width:400px;min-width:280px;margin-top:10px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
[data-theme="dark"] .cart{background:#1f2937;color:white}
.cart h3{margin-bottom:10px;font-size:18px}
.cart small{color:var(--gray)}
.cart-table{width:100%;border-collapse:collapse;display:block;overflow-x:auto;white-space:nowrap}
.cart-table th, .cart-table td{padding:8px 10px;text-align:center;font-size:14px}
.cart-table th{background:var(--primary);color:white}
.cart-table tr:nth-child(even){background:rgba(0,0,0,0.03)}
[data-theme="dark"] .cart-table tr:nth-child(even){background:rgba(255,255,255,0.05)}
.cart-table input{width:52px;text-align:center;border:1px solid #ccc;border-radius:4px;padding:3px}
.cart-table button{background:#e74c3c;color:white;border:none;border-radius:6px;padding:4px 8px;cursor:pointer}
.cart-table button:hover{opacity:0.9}
.cart-total{margin-top:12px;font-weight:bold;font-size:16px;text-align:right;color:var(--secondary)}
.cart-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.cart-actions button{background:var(--primary)}

/* Sections */
.section{display:none}
.section.active{display:block}

/* Chef cards */
.order-card{background:white;border-radius:12px;padding:12px;margin:10px 0;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
[data-theme="dark"] .order-card{background:#1f2937;color:white}
.order-card h4{margin-bottom:6px;color:var(--primary)}
.order-actions{display:flex;gap:8px;margin-top:8px}
.order-actions .ok{background:#10b981}
.order-actions .no{background:#ef4444}

/* Dashboard */
.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin:10px 0}
.kpi{background:white;border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
[data-theme="dark"] .kpi{background:#1f2937;color:white}
.kpi h5{color:var(--gray);font-weight:600;margin-bottom:6px}
.kpi .val{font-size:20px;font-weight:700;color:var(--secondary)}

.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{border:1px solid #e5e7eb;padding:8px;text-align:center}
.table th{background:var(--primary);color:#fff}

/* Filters row in dashboard */
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.row input, .row select{padding:6px 8px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;color:#111}
[data-theme="dark"] .row input,[data-theme="dark"] .row select{background:#111827;color:#fff;border-color:#374151}
.row button{padding:7px 10px;border:none;border-radius:8px;background:var(--secondary);color:#111;font-weight:600}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:16px}
.modal .box{background:#fff;border-radius:12px;max-width:520px;width:100%;padding:16px}
[data-theme="dark"] .modal .box{background:#0b1220;color:#fff}
.modal .box header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.modal .box header h4{margin:0}
.modal .box footer{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}

/* Notice */
.notice{margin-top:10px;padding:10px;border-radius:8px;display:none}
.notice.err{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
.notice.ok{background:#dcfce7;color:#065f46;border:1px solid #bbf7d0}

@media(max-width:900px){.sidebar{position:fixed;left:-220px;z-index:50;transition:0.25s}.sidebar.open{left:0}.main-container{padding-left:0}.menu-toggle{display:inline-block;color:#fff}}
</style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="logo"><h1>G<span style="color:var(--secondary)">ERP</span></h1></div>
    <div class="menu-item active" data-target="menuSec"><i class="fas fa-utensils"></i><span>Menu</span></div>
    <div class="menu-item" data-target="chefSec"><i class="fas fa-hat-chef"></i><span>Chef</span></div>
    <div class="menu-item" data-target="dashSec"><i class="fas fa-chart-line"></i><span>Dashboard</span></div>
  </div>

  <!-- Main Content -->
  <div class="main-container">
    <!-- Navbar -->
    <div class="navbar">
      <div class="logo" style="display:flex;align-items:center;gap:8px">
        <button class="menu-toggle" onclick="toggleSidebar()" style="display:none"><i class="fas fa-bars"></i></button>
        <h1 id="navTitle">Menu</h1>
      </div>
      <div class="search-bar" id="searchWrap">
        <i class="fas fa-search" style="margin-right:5px"></i>
        <input type="text" id="searchInput" placeholder="Search menu items..." />
      </div>
      <div class="user-actions">
        <button id="themeToggle" title="Toggle dark"><i class="fas fa-moon"></i></button>
        <img src="https://randomuser.me/api/portraits/men/41.jpg" alt="user" />
      </div>
    </div>

    <!-- top notice -->
    <div id="globalNotice" class="notice"></div>

    <!-- MENU SECTION -->
    <section id="menuSec" class="section active">
      <!-- Filters -->
      <div class="filters" id="filters"></div>

      <!-- Menu + Cart -->
      <div class="content-wrap">
        <div class="menu-grid" id="menuGrid"></div>
        <div class="cart" id="cart">
          <h3>Cart</h3>
          <small>Customer Name</small>
          <input type="text" id="customerName" placeholder="Enter customer name" style="width:100%;margin:6px 0 8px;padding:8px;border-radius:8px;border:1px solid #e5e7eb" />
          <div id="cartItems"></div>
          <div class="cart-total" id="cartTotal">Total: $0</div>
          <div class="cart-actions">
            <button onclick="clearCart()"><i class="fas fa-broom"></i> Clear</button>
            <button onclick="placeOrder()" style="background:var(--secondary);color:#111"><i class="fas fa-paper-plane"></i> Place Order</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CHEF SECTION -->
    <section id="chefSec" class="section">
      <div class="row" style="justify-content:space-between">
        <h3>Cooking Queue</h3>
        <button onclick="clearAllData()" title="Danger: clear all data"><i class="fas fa-trash"></i> Reset</button>
      </div>
      <div id="chefList"></div>
    </section>

    <!-- DASHBOARD SECTION -->
    <section id="dashSec" class="section">
      <div class="row">
        <div style="display:flex;gap:8px;align-items:center"><i class="fas fa-filter"></i><strong>Date range:</strong></div>
        <input type="date" id="fromDate" />
        <span>to</span>
        <input type="date" id="toDate" />
        <button onclick="applyDateFilter()">Apply</button>
        <button onclick="setToday()">Today</button>
      </div>

      <div class="kpis">
        <div class="kpi"><h5>Total Customers</h5><div class="val" id="kpiCustomers">0</div></div>
        <div class="kpi"><h5>Total Revenue</h5><div class="val">$<span id="kpiRevenue">0</span></div></div>
        <div class="kpi"><h5>Total Profit (30%)</h5><div class="val">$<span id="kpiProfit">0</span></div></div>
        <div class="kpi"><h5>Products Sold</h5><div class="val" id="kpiItems">0 pcs</div></div>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>Booking ID</th>
            <th>Customer</th>
            <th>Date</th>
            <th>Total Bill</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="dashTable"></tbody>
      </table>

      <div style="margin-top:10px">
        <h4>Sold Items (count)</h4>
        <ul id="soldList"></ul>
      </div>
    </section>

    <!-- DETAILS MODAL -->
    <div class="modal" id="detailModal">
      <div class="box">
        <header>
          <h4>Booking Details</h4>
          <button onclick="closeModal()" title="Close" style="background:none;border:none;font-size:18px"><i class="fas fa-times"></i></button>
        </header>
        <div id="detailBody" style="max-height:60vh;overflow:auto"></div>
        <footer>
          <button onclick="generateBillForSelected()" style="background:var(--secondary);color:#111;padding:8px 12px;border-radius:8px;border:none;font-weight:600"><i class="fas fa-file-invoice"></i> Generate Bill</button>
        </footer>
      </div>
    </div>

  </div>

<script>
// ====== DATA ======
const MENU = [
  {name:'Margherita Pizza',price:12,desc:'Cheese & tomato',cat:'Pizza',img:'https://source.unsplash.com/400x300/?pizza'},
  {name:'Pepperoni Pizza',price:14,desc:'Pepperoni & cheese',cat:'Pizza',img:'https://source.unsplash.com/400x300/?pizza&sig=1'},
  {name:'Cheeseburger',price:10,desc:'Beef patty with cheese',cat:'Burger',img:'https://source.unsplash.com/400x300/?burger'},
  {name:'Veggie Burger',price:9,desc:'Vegetables & patty',cat:'Burger',img:'https://source.unsplash.com/400x300/?burger&sig=2'},
  {name:'Caesar Salad',price:8,desc:'Fresh greens',cat:'Salad',img:'https://source.unsplash.com/400x300/?salad'},
  {name:'Pasta Carbonara',price:14,desc:'Creamy pasta with bacon',cat:'Pasta',img:'https://source.unsplash.com/400x300/?pasta'},
  {name:'Sushi Platter',price:20,desc:'Assorted sushi',cat:'Sushi',img:'https://source.unsplash.com/400x300/?sushi'}
];

const LS_KEYS = {
  CART: 'gERP_cart',
  BOOKINGS: 'gERP_bookings', // master list of all bookings
  NOTICE: 'gERP_notice' // message to show on menu after cancel
};

// booking shape: { id, customer, items:[{name,price,qty}], date:'YYYY-MM-DD', status:'pending|confirmed|cancelled', bill:false }

// ====== UTIL ======
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const todayStr = () => new Date().toISOString().slice(0,10);

function money(n){ return Number(n).toFixed(2); }
function sumItems(items){ return items.reduce((a,b)=> a + b.price * b.qty, 0); }
function readLS(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch(e){ return fallback } }
function writeLS(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

// ====== STATE ======
let cart = readLS(LS_KEYS.CART, []);
let bookings = readLS(LS_KEYS.BOOKINGS, []);
let currentView = 'menuSec';
let selectedBookingId = null;

// ====== SIDEBAR NAV ======
function switchView(target){
  $$('.menu-item').forEach(mi=> mi.classList.toggle('active', mi.dataset.target===target));
  $$('.section').forEach(sec=> sec.classList.toggle('active', sec.id===target));
  currentView = target;
  $('#navTitle').innerText = target==='menuSec' ? 'Menu' : target==='chefSec' ? 'Chef' : 'Dashboard';
  $('#searchWrap').style.display = target==='menuSec' ? 'flex' : 'none';
  if(target==='chefSec') renderChef();
  if(target==='dashSec') renderDashboard();
}
$$('.menu-item').forEach(mi=> mi.addEventListener('click', ()=> switchView(mi.dataset.target)));

function toggleSidebar(){ $('#sidebar').classList.toggle('open'); }

// ====== THEME ======
$('#themeToggle').addEventListener('click',()=>{
  const e = document.documentElement;
  if(e.getAttribute('data-theme')==='dark') e.removeAttribute('data-theme');
  else e.setAttribute('data-theme','dark');
});

// ====== FILTERS + MENU RENDER ======
const categories = ['All', ...new Set(MENU.map(i=>i.cat))];
const filtersDiv = $('#filters');
let displayed = [...MENU];

categories.forEach(cat=>{
  const btn = document.createElement('button');
  btn.textContent = cat;
  if(cat==='All') btn.classList.add('active');
  btn.onclick = () => { filterCategory(cat); $$('#filters button').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); };
  filtersDiv.appendChild(btn);
});

function filterCategory(cat){ displayed = (cat==='All') ? [...MENU] : MENU.filter(i=> i.cat===cat); applySearch(); }
$('#searchInput').addEventListener('input', applySearch);

function applySearch(){
  const q = $('#searchInput').value.toLowerCase();
  const items = displayed.filter(i=> i.name.toLowerCase().includes(q));
  renderMenu(items);
}

function renderMenu(items){
  const grid = $('#menuGrid');
  grid.innerHTML = '';
  items.forEach(item=>{
    const card = document.createElement('div');
    card.className = 'menu-card';
    card.innerHTML = `
      <img src="${item.img}" alt="${item.name}">
      <div class="menu-card-content">
        <h3>${item.name}</h3>
        <p>${item.desc}</p>
        <span class="price">$${money(item.price)}</span>
        <button onclick="addToCart('${item.name.replace(/'/g,"\\'")}', ${item.price})">Add to Order</button>
      </div>`;
    grid.appendChild(card);
  });
}

// ====== CART ======
function addToCart(name, price){
  const ex = cart.find(i=> i.name===name);
  if(ex) ex.qty += 1; else cart.push({name, price, qty:1});
  persistCart();
}
function changeQty(idx, val){ cart[idx].qty = Math.max(1, parseInt(val)||1); persistCart(); }
function removeItem(idx){ cart.splice(idx,1); persistCart(); }
function clearCart(){ cart = []; persistCart(); }

function persistCart(){ writeLS(LS_KEYS.CART, cart); renderCart(); }

function renderCart(){
  const container = $('#cartItems');
  if(!cart.length){
    container.innerHTML = "<p style='text-align:center;color:gray;'>Cart is empty</p>";
    $('#cartTotal').innerText = 'Total: $0.00';
    return;
  }
  let html = `<table class="cart-table"><thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Remove</th></tr></thead><tbody>`;
  cart.forEach((it,i)=>{
    html += `<tr>
      <td>${it.name}</td>
      <td><input type="number" min="1" value="${it.qty}" onchange="changeQty(${i}, this.value)"></td>
      <td>$${money(it.price*it.qty)}</td>
      <td><button onclick="removeItem(${i})"><i class='fas fa-trash'></i></button></td>
    </tr>`;
  });
  html += `</tbody></table>`;
  container.innerHTML = html;
  $('#cartTotal').innerText = `Total: $${money(cart.reduce((a,b)=> a + b.price*b.qty, 0))}`;
}

// Place Order → create booking (pending) and send to Chef
function placeOrder(){
  const customer = $('#customerName').value.trim();
  if(!customer){ alert('Enter customer name'); return; }
  if(!cart.length){ alert('Cart is empty'); return; }
  const id = 'B' + Date.now();
  const date = todayStr();
  const items = cart.map(i=> ({ name:i.name, price:i.price, qty:i.qty }));
  const booking = { id, customer, items, date, status:'pending', bill:false };
  bookings.push(booking);
  writeLS(LS_KEYS.BOOKINGS, bookings);
  cart = []; persistCart();
  $('#customerName').value = '';
  showNotice('Order placed successfully! Booking sent to Chef.', true);
  switchView('chefSec');
}

// ====== CHEF PAGE ======
function renderChef(){
  const list = $('#chefList');
  const pendings = bookings.filter(b=> b.status==='pending');
  if(!pendings.length){ list.innerHTML = `<p style='color:var(--gray)'>No pending orders</p>`; return; }
  list.innerHTML = pendings.map(b=>{
    const total = money(sumItems(b.items));
    const lines = b.items.map(it=> `${it.name} x${it.qty} ($${money(it.price*it.qty)})`).join('<br>');
    return `<div class='order-card'>
      <h4>${b.customer} — <small>ID: ${b.id}</small></h4>
      <div>${lines}</div>
      <div style='margin-top:6px'><strong>Total: $${total}</strong> • <small>${b.date}</small></div>
      <div class='order-actions'>
        <button class='ok' onclick="confirmOrder('${b.id}')"><i class='fas fa-check'></i> Confirm</button>
        <button class='no' onclick="cancelOrder('${b.id}')"><i class='fas fa-times'></i> Cancel</button>
      </div>
    </div>`;
  }).join('');
}

function confirmOrder(id){
  const b = bookings.find(x=> x.id===id);
  if(!b) return;
  b.status = 'confirmed';
  writeLS(LS_KEYS.BOOKINGS, bookings);
  renderChef();
  showNotice(`Booking ${id} confirmed.`, true);
}

function cancelOrder(id){
  const b = bookings.find(x=> x.id===id);
  if(!b) return;
  b.status = 'cancelled';
  writeLS(LS_KEYS.BOOKINGS, bookings);
  // push a notice to menu page
  writeLS(LS_KEYS.NOTICE, {msg:`Product not available for booking ${id}.`, type:'err'});
  renderChef();
  switchView('menuSec');
  maybeShowSavedNotice();
}

// ====== DASHBOARD ======
function setToday(){
  $('#fromDate').value = todayStr();
  $('#toDate').value = todayStr();
  renderDashboard();
}

function applyDateFilter(){ renderDashboard(); }

function filteredBookings(){
  let list = bookings.filter(b=> b.status==='confirmed');
  const f = $('#fromDate').value;
  const t = $('#toDate').value;
  if(f){ list = list.filter(b=> b.date >= f); }
  if(t){ list = list.filter(b=> b.date <= t); }
  return list;
}

function renderDashboard(){
  // default to today view if no filter set
  if(!$('#fromDate').value && !$('#toDate').value) setToday();
  const data = filteredBookings();
  const tbody = $('#dashTable');
  tbody.innerHTML = '';

  let custCount = 0, revenue = 0, itemsCount = 0; const soldMap = {};

  data.forEach(b=>{
    const total = sumItems(b.items);
    // Revenue counts only if bill generated
    if(b.bill){ revenue += total; custCount += 1; b.items.forEach(it=>{ itemsCount += it.qty; soldMap[it.name] = (soldMap[it.name]||0) + it.qty; }); }
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><a href="#" onclick="openDetails('${b.id}');return false;">${b.id}</a></td>
      <td>${b.customer}</td>
      <td>${b.date}</td>
      <td>$${money(total)}</td>
      <td>${b.bill?'<span style="color:#10b981">Billed</span>':'<span style="color:#f59e0b">Confirmed</span>'}</td>`;
    tbody.appendChild(tr);
  });

  $('#kpiCustomers').innerText = custCount;
  $('#kpiRevenue').innerText  = money(revenue);
  $('#kpiProfit').innerText   = money(revenue * 0.30);
  $('#kpiItems').innerText    = `${itemsCount} pcs`;
  const sold = $('#soldList'); sold.innerHTML = '';
  Object.entries(soldMap).forEach(([name,qty])=>{
    const li = document.createElement('li'); li.textContent = `${name} — ${qty} pcs`; sold.appendChild(li);
  });
}

function openDetails(id){
  selectedBookingId = id;
  const b = bookings.find(x=> x.id===id);
  if(!b) return;
  const lines = b.items.map(it=> `<li>${it.name} — $${money(it.price)} × ${it.qty} = $${money(it.price*it.qty)}</li>`).join('');
  $('#detailBody').innerHTML = `
    <p><strong>Customer:</strong> ${b.customer}</p>
    <p><strong>Date:</strong> ${b.date}</p>
    <p><strong>Booking ID:</strong> ${b.id}</p>
    <ul style="margin-top:8px">${lines}</ul>
    <p style="margin-top:8px"><strong>Total:</strong> $${money(sumItems(b.items))}</p>
    <p>Status: ${b.bill?'<span style="color:#10b981">Billed</span>':'<span style="color:#f59e0b">Confirmed</span>'}</p>`;
  $('#detailModal').style.display = 'flex';
}
function closeModal(){ $('#detailModal').style.display = 'none'; }

function generateBillForSelected(){
  if(!selectedBookingId) return;
  const b = bookings.find(x=> x.id===selectedBookingId);
  if(!b) return;
  b.bill = true; // mark billed
  writeLS(LS_KEYS.BOOKINGS, bookings);
  alert(`Bill Generated for ${b.id}: $${money(sumItems(b.items))}`);
  closeModal();
  renderDashboard();
}

// ====== NOTICES ======
function showNotice(text, ok=false){
  const n = $('#globalNotice');
  n.textContent = text; n.className = `notice ${ok?'ok':'err'}`; n.style.display = 'block';
  setTimeout(()=>{ n.style.display='none'; }, 3500);
}
function maybeShowSavedNotice(){
  const note = readLS(LS_KEYS.NOTICE, null);
  if(note){ showNotice(note.msg, note.type==='ok'); localStorage.removeItem(LS_KEYS.NOTICE); }
}

// ====== INIT ======
function boot(){
  // render menu
  applySearch();
  // render cart
  renderCart();
  // restore pending notices (e.g., cancel from chef)
  maybeShowSavedNotice();
  // default to Menu view
  switchView('menuSec');
}

// Expose for onclick
window.addToCart = addToCart;
window.changeQty = changeQty;
window.removeItem = removeItem;
window.placeOrder = placeOrder;
window.confirmOrder = confirmOrder;
window.cancelOrder = cancelOrder;
window.openDetails = openDetails;
window.closeModal = closeModal;
window.generateBillForSelected = generateBillForSelected;
window.clearCart = clearCart;
window.applyDateFilter = applyDateFilter;
window.setToday = setToday;
window.toggleSidebar = toggleSidebar;
window.clearAllData = function(){ if(confirm('Clear ALL data?')){ localStorage.clear(); cart=[]; bookings=[]; boot(); showNotice('All data cleared', true);} };

window.addEventListener('load', boot);
</script>
</body>
</html>