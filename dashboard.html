<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GourmetERP - Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{
  --primary:#2c3e50; --secondary:#c9902c; --light:#f5f7fa; --dark:#1e272e;
  --success:#27ae60; --warning:#f39c12; --danger:#e74c3c; --gray:#95a5a6;
}
[data-theme="dark"]{
  --light:#1e272e; --dark:#f5f7fa; --primary:#111827; --secondary:#fbbf24; --gray:#9ca3af;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{display:flex;min-height:100vh;background:var(--light);color:var(--dark);transition:0.3s;}
.sidebar{width:250px;background:var(--primary);color:white;padding:20px 0;display:flex;flex-direction:column;}
.logo{text-align:center;margin-bottom:20px;}
.logo h1{color:white;font-size:26px;font-weight:bold;}
.menu-item{padding:14px 20px;cursor:pointer;color:#ddd;font-weight:500;transition:all 0.3s;font-size:16px;}
.menu-item:hover{background:rgba(255,255,255,0.1);color:white;border-left:4px solid var(--secondary);}
.menu-item.active{background:rgba(255,255,255,0.15);color:white;border-left:4px solid var(--secondary);}
.main-content{flex:1;display:flex;flex-direction:column;padding:20px;gap:20px;overflow-y:auto;}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;}
.header h2{font-size:24px;color:var(--primary);}
.header .actions{display:flex;gap:10px;align-items:center;margin-top:10px;}
.header input{padding:6px 10px;border-radius:6px;border:1px solid #ccc;width:200px;}
.header button{padding:8px 14px;border:none;border-radius:8px;background:var(--secondary);color:white;cursor:pointer;transition:0.3s;}
.header button:hover{background:#b57f1b;}
.stats-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;}
.stat-card{background:white;border-radius:12px;padding:15px;box-shadow:0 6px 18px rgba(0,0,0,0.08);text-align:center;transition:0.3s;}
.stat-card h3{font-size:20px;margin-bottom:5px;}
.table-container{overflow-x:auto;}
table{width:100%;border-collapse:collapse;border-radius:10px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
th,td{padding:10px;text-align:left;}
th{background:var(--primary);color:white;}
tr:hover{background:rgba(201,144,44,0.1);}
button.invoice-btn{padding:6px 12px;border:none;border-radius:6px;background:var(--secondary);color:white;cursor:pointer;transition:0.3s;}
button.invoice-btn:hover{background:#b57f1b;}
.date-filter{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px;}
.date-filter input, .date-filter button{padding:6px 10px;border-radius:6px;border:1px solid #ccc;cursor:pointer;}
.logout-btn{padding:6px 12px;border:none;border-radius:6px;background:#e74c3c;color:white;cursor:pointer;transition:0.3s;}
.logout-btn:hover{background:#c0392b;}
[data-theme="dark"] body{background:#1e272e;color:white;}
[data-theme="dark"] .stat-card{background:#1f2937;color:white;}
[data-theme="dark"] table{background:#1f2937;color:white;}
[data-theme="dark"] th{background:#111827;color:white;}
[data-theme="dark"] tr:hover{background:rgba(255,255,255,0.1);}
[data-theme="dark"] .header h2{color:white;}
[data-theme="dark"] .header button{background:#fbbf24;color:#111827;}
[data-theme="dark"] .header button:hover{background:#d1a92f;}
[data-theme="dark"] .header input{background:#374151;color:white;border:1px solid #555;}
@media(max-width:768px){.stats-cards{grid-template-columns:1fr;}}
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo"><h1>G<span style="color:var(--secondary)">ERP</span></h1></div>
  <div class="menu-item" onclick="location.href='menu.html'">Menu</div>
  <div class="menu-item" onclick="location.href='chef.html'">Cooking</div>
  <div class="menu-item active">Dashboard</div>
</div>

<div class="main-content">
  <div class="header">
    <h2>Dashboard</h2>
    <div class="actions">
      <input type="text" placeholder="Search Booking/Customer..." id="searchInput">
      <button onclick="toggleTheme()">ðŸŒ™ Theme</button>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="stats-cards">
    <div class="stat-card"><h3 id="totalCustomers">0</h3><p>Customers</p></div>
    <div class="stat-card"><h3 id="totalRevenue">$0</h3><p>Revenue</p></div>
    <div class="stat-card"><h3 id="totalProfit">$0</h3><p>Profit</p></div>
  </div>

  <div class="date-filter">
    <label>From: <input type="date" id="fromDate"></label>
    <label>To: <input type="date" id="toDate"></label>
    <button onclick="applyDateFilter()">Filter</button>
    <button onclick="resetFilter()">Reset</button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr><th>Booking ID</th><th>Customer</th><th>Date</th><th>Total</th><th>Action</th></tr>
      </thead>
      <tbody id="bookingTable"></tbody>
    </table>
  </div>
</div>

<script>
// Load confirmed bookings
let bookings = JSON.parse(localStorage.getItem('gERP_bookings')||'[]');

function renderTable(filtered){
  const data = filtered||bookings.filter(b=>b.status==='Confirmed');
  const tbody=document.getElementById('bookingTable');
  tbody.innerHTML='';
  let totalRevenue=0;
  data.forEach(b=>{
    let total = b.items.reduce((sum,i)=>sum+i.qty*i.price,0);
    totalRevenue+=total;
    const row=tbody.insertRow();
    row.insertCell(0).innerHTML=`<a href="#" onclick="viewDetails('${b.id}')">${b.id}</a>`;
    row.insertCell(1).innerText=b.customer;
    row.insertCell(2).innerText=b.date;
    row.insertCell(3).innerText='$'+total;
    row.insertCell(4).innerHTML=`<button class="invoice-btn" onclick="generateInvoice('${b.id}')">Invoice</button>`;
  });
  document.getElementById('totalCustomers').innerText=data.length;
  document.getElementById('totalRevenue').innerText='$'+totalRevenue;
  document.getElementById('totalProfit').innerText='$'+Math.floor(totalRevenue*0.7);
}

// Search functionality
document.getElementById('searchInput').addEventListener('input',()=>{
  const q=document.getElementById('searchInput').value.toLowerCase();
  const filtered=bookings.filter(b=>b.status==='Confirmed' && (b.id.toLowerCase().includes(q) || b.customer.toLowerCase().includes(q)));
  renderTable(filtered);
});

function viewDetails(id){
  const b = bookings.find(b=>b.id===id);
  if(b){
    let msg=`Booking ${b.id}\nCustomer: ${b.customer}\nDate: ${b.date}\n\nItems:\n`;
    b.items.forEach(i=>msg+=`${i.name} x${i.qty} ($${i.price*i.qty})\n`);
    alert(msg);
  }
}

// Invoice PDF Ultra-Premium
function generateInvoice(id){
  const b = bookings.find(b=>b.id===id);
  if(!b) return;
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt',format:'a4'});
  const margin=40;
  let y=40;

  // Logo
  const imgUrl='https://source.unsplash.com/80x50/?restaurant,logo';
  doc.addImage(imgUrl,'JPEG',margin,y,80,50);
  y+=60;

  // Title
  doc.setFontSize(22);
  doc.setTextColor('#2c3e50');
  doc.text('GourmetERP Invoice',margin,y);
  y+=30;

  doc.setFontSize(12);
  doc.setTextColor('#000');
  doc.text(`Booking ID: ${b.id}`,margin,y);
  doc.text(`Customer: ${b.customer}`,margin+250,y);
  y+=18;
  doc.text(`Date: ${b.date}`,margin,y);
  y+=20;

  // Table Header
  doc.setFillColor(201,144,44);
  doc.setTextColor(255,255,255);
  doc.rect(margin,y,500,20,'F');
  doc.text('Item',margin+5,y+14);
  doc.text('Qty',margin+220,y+14);
  doc.text('Price',margin+300,y+14);
  doc.text('Total',margin+400,y+14);
  y+=20;

  // Table Rows
  doc.setTextColor(0,0,0);
  let grandTotal=0;
  b.items.forEach(i=>{
    const rowTotal=i.price*i.qty;
    grandTotal+=rowTotal;
    doc.rect(margin,y,500,20); // border
    doc.text(i.name,margin+5,y+14);
    doc.text(i.qty.toString(),margin+220,y+14);
    doc.text(`$${i.price}`,margin+300,y+14);
    doc.text(`$${rowTotal}`,margin+400,y+14);
    y+=20;
  });

  // Total
  y+=10;
  doc.setFontSize(14);
  doc.text(`Grand Total: $${grandTotal}`,margin,y);

  doc.save(`${b.id}_invoice.pdf`);
}

// Date filter
function applyDateFilter(){
  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;
  if(!from || !to) return;
  const filtered = bookings.filter(b=>b.status==='Confirmed' && b.date>=from && b.date<=to);
  renderTable(filtered);
}

function resetFilter(){
  document.getElementById('fromDate').value='';
  document.getElementById('toDate').value='';
  document.getElementById('searchInput').value='';
  renderTable();
}

// Theme toggle
function toggleTheme(){
  if(document.documentElement.getAttribute('data-theme')==='dark'){
    document.documentElement.removeAttribute('data-theme');
  } else { document.documentElement.setAttribute('data-theme','dark'); }
}

// Logout
function logout(){
  localStorage.removeItem('gERP_loggedIn');
  window.location.href='index.html';
}

renderTable();
</script>

</body>
</html>
